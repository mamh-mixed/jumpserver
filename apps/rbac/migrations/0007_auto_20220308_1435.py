# Generated by Django 3.1.14 on 2022-03-08 06:35

from django.db import migrations


def delete_unused_permissions(apps, schema_editor):
    permission_model = apps.get_model('rbac', 'Permission')
    content_type_model = apps.get_model('rbac', 'ContentType')
    content_type_delete_required = [
        ('common', 'permission'),
    ]
    for app, model in content_type_delete_required:
        content_type_model.objects.filter(app_label=app, model=model).delete()

    permissions_delete_required = [
        ('rbac', 'menupermission', 'view_resourcestatistics'),
        ('rbac', 'menupermission', 'view_adminview'),
        ('rbac', 'menupermission', 'view_overview'),
        ('rbac', 'menupermission', 'view_userview'),
        ('rbac', 'menupermission', 'view_filemanager'),
        ('authentication', 'connectiontoken', 'delete_connectiontoken'),
        ('authentication', 'connectiontoken', 'change_connectiontoken'),
        ('authentication', 'superconnectiontoken', 'delete_superconnectiontoken'),
        ('authentication', 'superconnectiontoken', 'change_superconnectiontoken'),
        ('authentication', 'superconnectiontoken', 'view_superconnectiontoken'),
        ('authentication', 'ssotoken', 'view_ssotoken'),
        ('authentication', 'ssotoken', 'change_ssotoken'),
        ('authentication', 'ssotoken', 'delete_ssotoken'),
        ('tickets', 'approvalrule', 'add_approvalrule'),
        ('tickets', 'approvalrule', 'view_approvalrule'),
        ('tickets', 'approvalrule', 'change_approvalrule'),
        ('tickets', 'approvalrule', 'delete_approvalrule'),
        ('tickets', 'comment', 'delete_comment'),
        ('tickets', 'comment', 'change_comment'),
        ('tickets', 'superticket', 'delete_superticket'),
        ('tickets', 'ticketassignee', 'view_ticketassignee'),
        ('tickets', 'ticketassignee', 'change_ticketassignee'),
        ('tickets', 'ticketassignee', 'add_ticketassignee'),
        ('tickets', 'ticketassignee', 'delete_ticketassignee'),
        ('tickets', 'ticketflow', 'add_ticketflow'),
        ('tickets', 'ticketflow', 'delete_ticketflow'),
        ('tickets', 'ticketstep', 'add_ticketstep'),
        ('tickets', 'ticketstep', 'view_ticketstep'),
        ('tickets', 'ticketstep', 'delete_ticketstep'),
        ('tickets', 'ticketstep', 'change_ticketstep'),
        ('tickets', 'ticketsession', 'change_ticketsession'),
        ('tickets', 'ticketsession', 'delete_ticketsession'),
        ('tickets', 'ticket', 'change_ticket'),
        ('tickets', 'ticket', 'delete_ticket'),
        ('settings', 'setting', 'add_setting'),
        ('settings', 'setting', 'change_setting'),
        ('settings', 'setting', 'delete_setting'),
        ('settings', 'setting', 'view_setting'),
        ('settings', 'setting', 'change_terminal'),
        ('settings', 'setting', 'change_terminal_setting'),
    ]
    for app, model, codename in permissions_delete_required:
        permission_model.objects.filter(
            codename=codename, content_type__model=model, content_type__app_label=app
        ).delete()


class Migration(migrations.Migration):

    dependencies = [
        ('rbac', '0006_auto_20220307_1558'),
    ]

    operations = [
        migrations.AlterModelOptions(
            name='menupermission',
            options={'default_permissions': [], 'permissions': [('view_dashboard', 'Can view dashboard'), ('view_consoleview', 'Can view console view'), ('view_auditview', 'Can view audit view'), ('view_workspaceview', 'Can view workspace view'), ('view_webterminal', 'Can view web terminal'), ('view_filemanagement', 'Can view file management')], 'verbose_name': 'Menu permission'},
        ),
        migrations.RunPython(delete_unused_permissions)
    ]
